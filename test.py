import json
a = 0
result_list = []
with open('oo-labeled_correct.gpt4.sharegpt.jsonl', 'r', encoding="utf-8") as f:
    for line in f:
        print(a)
        result = {}
        result['system'] = ''
        result['instruction'] = ''
        result['response'] = ''
        result['embedding_str'] = ''
        embedding_str = ''
        data = json.loads(line)
        for item in data['conversations']:
            

            if item['from'] == 'system':
                embedding_str += ''
                result['system'] = item['value']
            elif item['from'] == 'gpt':
                embedding_str += 'ASSISTANT:'
                embedding_str += '\n'
                embedding_str += item['value']
                result['response'] = item['value']
            else:
                embedding_str += 'USER:'
                embedding_str += '\n'
                embedding_str += item['value']
                embedding_str += '\n\n'
                result['instruction'] = item['value']
        result['embedding_str'] = embedding_str
        # print(result)
        result_list.append(result)
        a += 1
        # if a == 1:
        #     break

import pandas as pd
df = pd.DataFrame(result_list)
df.to_csv('result.csv', index=False)

import torch
torch.cuda.empty_cache()

import pandas as pd 
df = pd.read_csv('result.csv')
print(df.head())

from angle_emb import AnglE
angle = AnglE.from_pretrained('WhereIsAI/UAE-Large-V1', pooling_strategy='cls').cuda()

import time
from tqdm import tqdm
import numpy as np

df_new = df.copy()
batch = 1536
embedding_str_batch = []
vec_all = []
for i in tqdm(range(len(df_new))):
    embedding_str_batch.append(df.iloc[i]['embedding_str'])
    if len(embedding_str_batch) == batch:
        time_1 = time.time()
        vec = angle.encode(embedding_str_batch, to_numpy=True)
        time_2 = time.time()
        print(time_2-time_1)
        embedding_str_batch = []
        vec_all += vec.tolist()
time_1 = time.time()
vec = angle.encode(embedding_str_batch, to_numpy=True)
time_2 = time.time()
print(time_2-time_1)
vec_all += vec.tolist()

df_new['embedding'] = vec_all
print(df_new.head(11))

df_new.to_csv('result_with_embedding.csv', index=False)

import pandas as pd
import numpy as np
df = pd.read_csv('result_with_embedding.csv')
df = df.reset_index()
print(df.iloc[203875]['embedding_str'])
print(df.iloc[203875]['embedding'])
print(df.iloc[0]['embedding_str'])
print(df.iloc[0]['embedding'])


ids = df["index"].values.astype(np.int64)
print(ids.shape)


datas = []
for x in df["embedding"]:
    datas.append(np.array([float(x) for x in x[1:-1].split(', ')]))

datas = np.array(datas).astype(np.float32)
print(datas.dtype)
print(datas.shape)

import faiss 
from faiss import normalize_L2

embedding_search = [-0.15532660484313965, 0.2102689892053604, -0.6801682710647583, 0.09806706011295319, -1.2178059816360474, -1.0171027183532715, -0.25627434253692627, 0.7353941798210144, 0.43478715419769287, 0.55789715051651, 0.6168493628501892, -0.6107861995697021, 0.42477789521217346, -0.24731406569480896, -0.6347734332084656, 0.10062060505151749, -0.3711649179458618, -0.26063236594200134, -0.08558591455221176, -0.21635717153549194, 0.6393393278121948, -0.11076712608337402, -0.945296585559845, -0.26109999418258667, -0.9353390336036682, 1.1399030685424805, 0.15501922369003296, -0.2878037393093109, 1.0205496549606323, 0.6532264351844788, 0.05926719680428505, -0.07322972267866135, 0.006827876903116703, -0.49353867769241333, 0.213148832321167, -0.0931035652756691, 0.9313658475875854, -1.079196572303772, -0.26832836866378784, -0.4198629856109619, -0.0593087300658226, 0.2769642174243927, 0.624057412147522, 0.062034379690885544, 0.0724281519651413, 0.3643437922000885, -0.07116369158029556, -0.6303457617759705, -0.7795299291610718, -0.6053342819213867, 0.044653646647930145, -0.09094119817018509, 0.49033939838409424, 0.18537427484989166, 0.3964545428752899, -0.5186018347740173, -0.5362780690193176, 0.1832159012556076, 0.12368180602788925, 0.46435680985450745, 0.18420183658599854, 0.26203882694244385, 0.03486697003245354, -0.4841730296611786, 0.35185399651527405, 0.6360957026481628, 0.4374915659427643, -0.17438329756259918, -0.5017355680465698, -0.10422129184007645, 0.2027839720249176, 0.2904658317565918, -0.3894682824611664, 0.06267155706882477, -0.6875825524330139, -0.46733221411705017, -0.30297884345054626, -0.6733919978141785, 0.8503682613372803, 0.12606671452522278, 0.34728550910949707, 0.6164268255233765, 0.21950174868106842, 0.5096526145935059, -0.5137675404548645, -0.34335699677467346, 0.44188281893730164, 0.8423763513565063, -0.00731468154117465, 0.2745966911315918, 0.3380971848964691, 0.2824522852897644, -0.15239059925079346, -0.20336107909679413, 0.4636305570602417, 0.5003454089164734, -0.49384990334510803, -0.17729900777339935, 0.08296921104192734, 0.15784521400928497, 0.5888470411300659, 0.4339786767959595, -0.3894228935241699, 0.37262338399887085, -0.9318177103996277, 1.11582350730896, 0.2058764398097992, -0.04566437751054764, -0.10940765589475632, -0.11364862322807312, -0.23721902072429657, 0.4031783938407898, 0.5956745147705078, -0.3359922170639038, -0.13190872967243195, 0.7357886433601379, 0.2291969209909439, 0.10380376875400543, -0.27596843242645264, 0.09005674719810486, 0.13606633245944977, 0.05169890075922012, 0.6722960472106934, -0.27263084053993225, 0.3066731095314026, -0.8507276773452759, 0.31935515999794006, 0.618148684501648, -0.30495506525039673, 0.17612464725971222, 0.04821905493736267, -0.21565859019756317, 0.3272593319416046, 0.24520628154277802, -0.5704964399337769, -0.016551658511161804, 0.03427936136722565, 0.7007100582122803, 0.12819096446037292, -0.396279901266098, 0.5851017236709595, -0.3494430482387543, 0.40598052740097046, 1.0728425979614258, 0.4986322820186615, 0.3138197660446167, -0.1417987197637558, 0.19039222598075867, -0.7115502953529358, 0.4622621238231659, -0.46625345945358276, -0.23738117516040802, 0.9458695650100708, 0.32273557782173157, 0.06503143906593323, -0.16429156064987183, 0.7223179340362549, -0.09387511759996414, 0.08704908937215805, 0.487056165933609, -0.8282374143600464, -0.394029825925827, 0.12970244884490967, 1.0478076934814453, -0.17891287803649902, 0.23623743653297424, -0.19862769544124603, -0.15173335373401642, 0.04579279199242592, -0.49439355731010437, 0.290402889251709, 0.5376917123794556, -0.3850941061973572, -0.22117716073989868, 1.0007270574569702, 0.6213662624359131, 0.02588970959186554, -1.0939325094223022, 0.6990780234336853, -0.6367465853691101, -0.20876950025558472, 0.9656085968017578, 0.6919230818748474, 0.0007487061084248126, 0.6656549572944641, 0.030535638332366943, -0.39516639709472656, -1.3190796375274658, -0.15491272509098053, -0.09869543462991714, 0.0925198420882225, 0.11896737664937973, -0.752848207950592, 0.5621588230133057, 0.9187710285186768, 0.6937094330787659, -0.6001549959182739, -0.5992642045021057, 0.391414076089859, -0.474012553691864, -0.24294964969158173, 0.16728846728801727, 0.4378787577152252, 0.12702138721942902, 0.4518899619579315, -0.6833924651145935, 0.4616363048553467, 1.3254940509796143, 0.17519143223762512, 0.2658916413784027, 0.31658411026000977, -0.35180482268333435, -0.48392754793167114, 0.014643805101513863, 0.5017938613891602, -0.012074639089405537, -0.40904903411865234, -0.00547570688650012, -0.5222117304801941, 0.04606543853878975, -0.9143127799034119, 0.42770513892173767, 0.028873439878225327, 0.4187292754650116, -0.7072387933731079, -0.6328973174095154, 0.42856162786483765, 0.2797001600265503, -0.1346755474805832, -0.40787091851234436, 0.4982091188430786, -0.010776089504361153, -0.5228652954101562, 0.29042378067970276, 0.15864326059818268, -0.14497174322605133, -0.194379523396492, 0.25477418303489685, 0.43822425603866577, -0.15123558044433594, 0.240661159157753, 0.5905336141586304, 0.8123462200164795, 0.6663459539413452, -0.18769440054893494, 0.8493368625640869, 0.5408504009246826, -0.15441755950450897, -0.39414796233177185, 0.7141713500022888, 0.3405381739139557, 0.26498255133628845, -0.45316460728645325, 0.22095473110675812, -0.7854164838790894, 0.09660283476114273, 0.2399897575378418, 0.3574632704257965, -0.07349022477865219, -0.41750767827033997, -0.4403412640094757, 0.17277224361896515, -0.12775422632694244, -0.07159234583377838, 0.6146897673606873, 0.5134544372558594, 0.951442301273346, -0.0357561893761158, -0.02159697934985161, -0.3706330358982086, -0.7193707823753357, -0.9955211877822876, -0.9212670922279358, 0.13943316042423248, -0.46372488141059875, -0.23707275092601776, 0.3932829201221466, -0.5109291672706604, 0.3542044162750244, 0.41013872623443604, 0.4422933757305145, 0.36336570978164673, -0.6002873778343201, 0.3471199572086334, 0.3528321385383606, -0.1023002490401268, -0.6672215461730957, 0.5742010474205017, -0.0246632881462574, 0.41010671854019165, -0.3335413932800293, -0.9339672923088074, -0.3820442855358124, -0.9549878239631653, 0.7832573652267456, -0.14656607806682587, 0.3266768753528595, 0.19634439051151276, -0.17628547549247742, -0.6574825644493103, 0.006399180274456739, -0.14535029232501984, 0.7687271237373352, 0.4118208885192871, -1.004785418510437, 0.49737656116485596, 0.2567521035671234, 0.28328737616539, 0.07457505166530609, -0.2895145118236542, -0.5470162034034729, 0.10761241614818573, -0.37242719531059265, 0.13151898980140686, -0.3021233081817627, 1.0630897283554077, 0.3122515082359314, 0.12608177959918976, 0.1876380890607834, -0.734615683555603, -0.22348587214946747, -1.0278351306915283, -0.15473468601703644, -1.1813336610794067, -0.13451895117759705, -0.35433679819107056, -0.25661012530326843, -1.223217487335205, -0.34754252433776855, -1.1661982536315918, -0.35150346159935, 0.2679065465927124, 0.07798004150390625, 0.8496284484863281, 0.26703503727912903, -0.10505947470664978, -0.3115164637565613, 0.11689859628677368, 0.05808093398809433, -0.20132127404212952, 0.1236792653799057, -1.1107529401779175, 0.1350768804550171, 0.9459803104400635, -0.1879173219203949, 1.0429315567016602, 0.687204897403717, -0.14675794541835785, -0.6681675910949707, -0.7682310938835144, -0.5167708396911621, -0.12411227822303772, -0.2104252576828003, -0.15640868246555328, 0.04248249903321266, 1.206785798072815, -0.661126971244812, -0.09074226766824722, 0.5008949041366577, 0.1791953593492508, 0.11389755457639694, -0.03305327892303467, -0.4437045454978943, -0.014372768811881542, -0.3126453757286072, -0.8055325746536255, 0.23675031960010529, -0.5983323454856873, 0.2706480622291565, -0.21405921876430511, 0.6407055258750916, -0.4099573493003845, -0.8226109147071838, 0.10951055586338043, -0.5149564743041992, -0.1878744512796402, 0.8948145508766174, 0.18979616463184357, 0.3104110062122345, -0.09764204919338226, 0.6712697744369507, -0.6288428902626038, 0.7575891613960266, 0.5983594655990601, -0.6364375352859497, 0.5163043737411499, 0.11396316438913345, -0.2308672070503235, 0.05161270499229431, -0.19192743301391602, -0.1808292418718338, -0.18640711903572083, 0.6865936517715454, -0.8257872462272644, -0.16342060267925262, -0.8375676870346069, -0.5517459511756897, 0.44945845007896423, 0.624851405620575, 0.19490034878253937, 0.9609699845314026, 0.3270823359489441, 1.0956085920333862, 0.324459046125412, -0.33316364884376526, 0.02766747772693634, -0.5207210779190063, 0.4030787944793701, 0.828210175037384, -0.5060107707977295, 0.06889570504426956, -0.18928998708724976, 0.5877996683120728, 0.013518236577510834, -0.023174075409770012, -0.2034507393836975, -0.8846960067749023, -0.04913504421710968, 0.10574934631586075, -0.07097586244344711, 0.0252365879714489, 0.04889189451932907, 0.1477048546075821, -0.40370088815689087, 0.7894221544265747, -0.14110809564590454, -0.2939285337924957, -0.8054352402687073, 0.8056271076202393, 0.05469251424074173, 0.1976107656955719, -0.7362966537475586, 0.36047959327697754, -0.023274438455700874, -0.40992018580436707, 0.4665944278240204, -0.2471478134393692, 0.2140512317419052, -0.3050335943698883, -1.3069539070129395, 0.2276405245065689, -0.02949105203151703, -0.16005420684814453, -0.10689318180084229, -0.2802271842956543, -0.1350184679031372, 0.2770959138870239, 0.8070992827415466, -0.569238007068634, 0.18791985511779785, 0.08558260649442673, -0.7818268537521362, 0.9483604431152344, -0.5483881831169128, -0.2109324336051941, 0.3596826493740082, -0.15447881817817688, 0.6737664937973022, 0.7701107263565063, -0.27665776014328003, 0.6459628939628601, -0.6784250736236572, -0.08382776379585266, -0.6851965188980103, 0.22331301867961884, 0.89337158203125, -0.7209441661834717, -0.20039139688014984, 0.46273985505104065, -0.020576003938913345, 0.5809574723243713, -0.3850347399711609, -0.2523287236690521, -0.2076907902956009, -0.4042787551879883, -0.7343966364860535, 0.35531458258628845, 1.1657676696777344, -0.090601347386837, -0.28636327385902405, -0.8205273747444153, 0.38013604283332825, 0.010727210901677608, -0.3022073209285736, -1.0753698348999023, -1.0661753416061401, 0.13129903376102448, 0.004345363937318325, 0.3261725604534149, 0.6611726880073547, 0.3133895695209503, 0.39729630947113037, -0.9344013333320618, 0.6642033457756042, -1.143231987953186, 0.3965636193752289, 0.003553850809112191, 0.12673959136009216, -0.32770097255706787, -0.40917423367500305, -0.09426577389240265, -0.36573582887649536, -0.5149089097976685, 0.4822247624397278, 0.35010430216789246, -0.619791567325592, -0.3156599998474121, 0.10819948464632034, -0.12400591373443604, -0.07029303908348083, -0.41685250401496887, 0.2597247064113617, -0.3651699721813202, -0.22474947571754456, 0.028247127309441566, 0.46218615770339966, 0.5567405819892883, 0.00019180707749910653, -0.15998710691928864, 0.23589089512825012, 0.7104056477546692, 0.4535682201385498, -0.10925862938165665, 1.2230256795883179, -0.9513011574745178, 0.18346743285655975, -0.2651463449001312, -0.6907554268836975, -1.3015390634536743, -1.7107689380645752, -0.7336796522140503, -0.8408528566360474, -1.1922423839569092, -0.6839662790298462, 0.2144259661436081, -0.5258683562278748, 0.13217251002788544, 0.035391803830862045, 0.8414816856384277, 0.5145070552825928, -1.3702219724655151, 0.309174507856369, 0.34347474575042725, -0.16050812602043152, -0.48079097270965576, -0.2641633450984955, 0.155533567070961, 0.358575701713562, -0.04787778854370117, 1.1234822273254395, 0.24685929715633392, -0.22327648103237152, 0.8818538784980774, -0.8520247340202332, -0.4532073438167572, -0.395494669675827, 0.2291267216205597, 0.010286184027791023, -0.1980239748954773, 0.06068677827715874, -0.9756671786308289, 0.7972899675369263, -0.5498982071876526, 0.5186977386474609, -0.5730549097061157, -0.4894646108150482, -0.2773117125034332, -0.3241879940032959, 1.4710757732391357, -0.9577538967132568, -0.46020209789276123, -0.007225021254271269, -0.06934504956007004, 0.4043280780315399, -0.08080555498600006, -0.18190966546535492, -0.27696552872657776, -0.44019263982772827, -0.9098816514015198, 0.9097533226013184, -0.30694934725761414, -0.37088847160339355, -0.3934542238712311, 0.8210726380348206, 0.07072047144174576, -0.5904154181480408, 0.6129115223884583, 1.221358299255371, -0.08340388536453247, 0.23318533599376678, -0.8920730948448181, 0.6742780804634094, 1.1737972497940063, -0.9355111718177795, -0.18832196295261383, 0.18354432284832, -0.24716833233833313, 0.08541446179151535, -0.20172080397605896, -1.056113600730896, -0.3574818968772888, 0.49384111166000366, 1.280340313911438, -0.7234286665916443, 0.5114831924438477, -0.43649083375930786, -0.4971410036087036, -0.5050196051597595, 0.8080492615699768, 0.4579683840274811, 0.03428052365779877, 0.6242126822471619, -0.05079357326030731, -0.2265823930501938, 0.18420931696891785, 0.016865020617842674, -0.6145967841148376, -0.7965723276138306, -0.3226540982723236, 0.03853660821914673, -0.671830415725708, 0.6411744356155396, 0.10906308144330978, -0.01889798976480961, -0.3780418634414673, -0.47953492403030396, 0.05409049242734909, -0.4899905323982239, -0.07600422948598862, -0.327964186668396, -0.4886961281299591, 0.08757703006267548, 1.1253935098648071, 0.6292670369148254, -0.13899031281471252, 0.4525950849056244, 0.12482696026563644, 0.12494096159934998, -0.24140436947345734, -0.08557450026273727, 0.5099324584007263, 0.35825514793395996, -0.460079550743103, 0.5611390471458435, -0.13260658085346222, 0.9725077152252197, -0.4190268814563751, 0.6755244135856628, -0.2730816602706909, -0.8611295819282532, -0.6971641182899475, 0.0014121542917564511, 0.7379419207572937, -0.14944814145565033, -0.020774032920598984, 0.9902925491333008, 0.05058881640434265, 0.4170888662338257, -0.7069733738899231, 0.371629923582077, -0.3480894863605499, 0.7253175973892212, -0.7601342797279358, -0.21187900006771088, 0.7131618857383728, 0.3761044442653656, 0.32731732726097107, -0.45944058895111084, -0.8004116415977478, -0.6348320245742798, 0.8393121957778931, -0.17632871866226196, 0.09847200661897659, -0.7478728294372559, 0.5847038626670837, 0.20329251885414124, -0.9372896552085876, -0.8993604183197021, 0.48655015230178833, -0.688710629940033, 0.6738840937614441, -0.49762651324272156, 0.349798321723938, -0.2804935872554779, -0.276665598154068, 0.09220758825540543, -0.5092682838439941, -0.8390694856643677, -0.0050615910440683365, 0.2895523011684418, -0.9564098119735718, -0.6105111241340637, 0.08520310372114182, -0.2068469077348709, 0.5487439632415771, 0.06877133995294571, 0.018933597952127457, -0.24871943891048431, -0.355341374874115, 0.3742782771587372, -0.08401728421449661, -0.3104330599308014, -0.34422188997268677, -0.1012648493051529, -0.2835767865180969, -0.1334262490272522, 0.10720930248498917, -0.7880309224128723, -0.20209869742393494, -0.8710834383964539, -0.21401353180408478, 0.4233301877975464, -0.4362971782684326, -0.3965736925601959, -0.39800265431404114, -0.8714308142662048, 0.6754148602485657, 0.22677429020404816, -0.1047220230102539, 0.5077540278434753, 0.17466670274734497, -0.5608392357826233, 0.8847159147262573, -0.5131257176399231, 0.8985568881034851, 0.3823585510253906, -0.3441522419452667, 0.4621737003326416, 0.3058738708496094, 0.9768101572990417, 0.4941781163215637, -0.6095016002655029, 0.10493215173482895, -0.09579409658908844, 0.25463688373565674, 0.2508191764354706, -0.8392494320869446, -0.8387466073036194, 0.21829527616500854, -0.30682381987571716, 0.26235708594322205, 0.17381057143211365, -0.15219096839427948, 0.3945445418357849, -0.03889035806059837, -1.5872222185134888, -0.6584069728851318, -0.8729074001312256, -0.06537090241909027, 0.6890048980712891, 0.215628519654274, 0.7471475601196289, -0.5417308211326599, -0.5500853657722473, 0.31260645389556885, -0.4015901982784271, 0.37062302231788635, 0.1792963594198227, -0.057175133377313614, -0.18015623092651367, 1.1700553894042969, -0.07069558650255203, 0.02240702509880066, -0.291216641664505, 0.4590282440185547, -0.7675034403800964, -0.2920178771018982, 0.822272539138794, 0.7915206551551819, -0.3387715518474579, -0.06627800315618515, -0.5559653639793396, -0.2585412561893463, -0.17080456018447876, -0.0353202261030674, 0.6038663983345032, 0.381390243768692, -0.5874499678611755, 0.45289018750190735, -0.7675356864929199, -0.12022320181131363, 0.27867591381073, 0.5318983197212219, 0.4206259846687317, -0.5590018630027771, -0.6304019093513489, -0.3355727195739746, 0.5627148747444153, 0.7326440811157227, 0.20077067613601685, 0.37299230694770813, 0.12030816078186035, -0.829159140586853, -0.20678353309631348, -0.4166445732116699, 0.568208634853363, 0.23725199699401855, -0.4352974593639374, 0.12694378197193146, 1.0826342105865479, 0.5896100997924805, -0.1363704353570938, -0.11742444336414337, 0.675274133682251, 0.08015699684619904, 0.39667409658432007, 0.08469870686531067, -0.2655673623085022, -0.3153606653213501, -0.19545342028141022, -0.1543789505958557, 1.1443222761154175, -1.009547472000122, 0.7975553274154663, -0.31603550910949707, 0.19854429364204407, 0.2913074195384979, -0.7325021624565125, -0.13272009789943695, -1.1085724830627441, 0.14189793169498444, 0.5173938870429993, 0.42176276445388794, -0.07905452698469162, 0.6094685196876526, 0.7568339109420776, 0.04479173570871353, 0.02452837862074375, -0.4239973723888397, 0.050824228674173355, 0.32194259762763977, -0.7349225282669067, 0.34366562962532043, -0.2577380836009979, 0.5589243769645691, 0.44033142924308777, -0.19279171526432037, 0.0839373990893364, -0.32354599237442017, 0.12574344873428345, 0.8206977844238281, 0.5471885204315186, -0.36421066522598267, 0.6607193946838379, -0.33287838101387024, 0.5672110319137573, -0.3864351212978363, -0.1206730380654335, 0.06148349866271019, -0.1825200766324997, -0.282903790473938, 0.6862793564796448, 0.08193136006593704, -0.4453194737434387, -0.4486878514289856, 0.6858528852462769, -0.010386761277914047, 0.7326231002807617, 0.5885109901428223, -0.2794162929058075, -0.6844877600669861, -0.11001107841730118, -0.27605074644088745, -0.3539935052394867, -0.6587914824485779, -0.03642367199063301, -0.1198916807770729, -0.19173210859298706, -0.9003435969352722, 0.11806263774633408, 0.07611630856990814, -0.07458603382110596, -0.841633677482605, 0.7468698620796204, -0.036650847643613815, 0.39307889342308044, 0.24581415951251984, -0.22385713458061218, -0.731803297996521, -0.21886037290096283, -0.2962791621685028, -0.1325545310974121, -0.0737653449177742, 0.5989096760749817, -0.7484000325202942, 0.49891623854637146, -0.9722760915756226, -0.5509751439094543, -0.9964112043380737, -0.3925984799861908, -0.20372439920902252, -0.3054181933403015, -0.26564261317253113, -0.8373872637748718, 0.38518035411834717, -0.12313148379325867, -0.5127301216125488, 0.6820386648178101, -0.5536627769470215, 0.026667408645153046, 0.407601922750473, 0.7487080097198486, 0.037875428795814514, 0.5448416471481323, 0.30852335691452026, -0.1110457256436348, 0.6842895150184631, -0.07039391249418259, 0.050402093678712845, 0.15596435964107513, -0.28185147047042847, -0.39570268988609314, 0.45923420786857605, 0.3582261800765991, -0.22211584448814392, 0.8202006220817566, -0.21041320264339447, 0.15627586841583252, -0.4670078754425049, -0.664036214351654, -0.431860089302063, -0.413404643535614, 0.0948195680975914, 0.0604572631418705, 0.24710725247859955, -0.5546835064888, 0.1031942367553711, -0.05463433265686035, -0.7560986280441284, 4.129158973693848, 0.2717929482460022, 0.22040724754333496, -0.7354782819747925, -0.3398515284061432, 0.014568439684808254, 0.62125563621521, 0.3888242840766907, -0.19899307191371918, -0.2774893343448639, 1.0930054187774658, -0.3015269339084625, 0.2846686542034149, 0.7601838111877441, 0.4816948175430298, 0.7729420065879822, -0.1601388305425644, 0.7905277609825134, 0.23665332794189453, -0.7265251278877258, -0.5319300293922424, -0.06846074014902115, 0.29200097918510437, -0.020726708695292473, 0.8743099570274353, 0.3324871063232422, 0.20417068898677826, 0.19968681037425995, 0.3429449498653412, -0.6305135488510132, -0.482828825712204, -0.8531455993652344, 0.24902421236038208, -0.7372169494628906, -0.7003602981567383, 0.4224245548248291, 0.4523959159851074, -0.5476119518280029, 0.2197641283273697, 0.1530373990535736, 0.21520867943763733, 0.11812455207109451, -0.34274792671203613, 0.06046532094478607, 0.15440282225608826, -0.0052670640870928764, 0.00679158978164196, 0.6356644630432129, 0.6603366732597351, -0.5978110432624817, 0.600319504737854, -0.25738176703453064, 1.296642780303955, -0.14552190899848938, -0.703777015209198, 0.6093066334724426, 0.5061487555503845, 0.21920323371887207, -0.49831536412239075, -0.32684704661369324, 0.20510482788085938, -0.30760249495506287, -0.44061577320098877, -0.6642709374427795, -0.13962407410144806, 0.861845850944519, 0.5444467067718506, 0.246455579996109, -0.3571361005306244, 0.3052465319633484, -0.23261822760105133, -0.009082610718905926, 0.6610575318336487, -0.287593275308609, 0.6613338589668274, 0.6940790414810181, -0.421901673078537, 0.11846434324979782, 0.8764585852622986, -0.035425733774900436, -0.207697793841362, -0.6622951030731201, -0.25871115922927856, 0.7593532800674438, 0.22201867401599884, 0.5090749263763428, -0.41283899545669556, -0.9986786246299744, 0.11195352673530579, 0.13906651735305786, 0.08166807889938354, -0.08599834889173508, 0.027114568278193474, 0.3344157636165619, 0.21295751631259918]

embedding_search = np.expand_dims(np.asarray(embedding_search), axis=0).astype(np.float32)
print(embedding_search.shape)
normalize_L2(datas)
normalize_L2(embedding_search)
quantizer = faiss.IndexFlatIP(datas.shape[1])
index = quantizer
index.add(datas.astype(np.float32))
content = {'id': ids, 'index': index}
distance, idx = content['index'].search(embedding_search.astype(np.float32), 5)
print(distance)
print(idx)



